<mat-sidenav-container ngClass.xs="toolbar-padding">

  <mat-sidenav fixedInViewport #drawer class="mat-elevation-z8" 
    [attr.role]="(isXs$ | async) ? 'dialog' : 'navigation'"
    [mode]="(isXs$ | async) ? 'over' : 'side'"
    [opened]="(isXs$ | async) === false">

    <mat-toolbar fxLayout="column" fxLayoutAlign="center start" style="line-height:1.3">

      <span
        [ngClass]="(conSub$ | async) ? 'color-green' : 'color-warn'">
        {{ (conSub$ | async) ? 'Tilkoblet internett' : 'Frakoblet internett' }}
      </span>

      <span *ngIf="currentUser$ | async; let user">{{ user.firstName }} {{ user.lastName }}</span>

    </mat-toolbar>
    <mat-divider></mat-divider>
    <mat-nav-list>
      <a mat-list-item (click)="toggleDrawer()" [routerLink]="['/hjem']" [routerLinkActive]="['active']">
        <mat-icon mat-list-icon>home</mat-icon>
        <p mat-line>Hjem</p>
      </a>
      <mat-divider class="mid-divider"></mat-divider>
      <a mat-list-item (click)="toggleDrawer()" [routerLink]="['/oppdrag']" [routerLinkActive]="['active']">
        <mat-icon mat-list-icon>view_list</mat-icon>
        <p mat-line>Oppdrag</p>
      </a>
      <mat-divider class="mid-divider"></mat-divider>
      <a mat-list-item (click)="toggleDrawer()" [routerLink]="['/timer']" [routerLinkActive]="['active']">
        <mat-icon mat-list-icon>timer</mat-icon>
        <p mat-line>Timeliste</p>
      </a>
      <ng-container *ifRole="[Roles.Leder, Roles.Mellomleder]">
        <!-- <mat-divider class="mid-divider"></mat-divider>
        <a mat-list-item (click)="toggleDrawer()" [routerLink]="['/oppdragsgivere']" [routerLinkActive]="['active']">
          <mat-icon mat-list-icon>work</mat-icon>
          <p mat-line>Oppdragsgivere</p>
        </a> -->
        <mat-divider class="mid-divider"></mat-divider>
        <a mat-list-item (click)="toggleDrawer()" [routerLink]="['/data']" [routerLinkActive]="['active']">
          <mat-icon mat-list-icon>dns</mat-icon>
          <p mat-line>Data</p>
        </a>
        <mat-divider class="mid-divider"></mat-divider>
        <a mat-list-item (click)="toggleDrawer()" [routerLink]="['/brukere']" [routerLinkActive]="['active']">
          <mat-icon mat-list-icon>people</mat-icon>
          <p mat-line>Brukere</p>
        </a>
      </ng-container>
      <mat-divider></mat-divider>
      <span style="position: absolute;bottom:0;width:100%;">
        <mat-divider></mat-divider>
        <a mat-list-item (click)="toggleDrawer()" [routerLink]="['/profil']" [routerLinkActive]="['active']">
          <mat-icon mat-list-icon>person</mat-icon>
          <p mat-line>Profil</p>
        </a>
        <mat-divider class="mid-divider"></mat-divider>
        <a mat-list-item (click)="handleLogout()">
          <mat-icon mat-list-icon>power_settings_new</mat-icon>
          <p mat-line>Logg ut</p>
        </a>
      </span>
    </mat-nav-list>

  </mat-sidenav>

  <mat-sidenav-content *ngIf="config$ | async; let config">

    <mat-toolbar class="mat-elevation-z8" 
      [ngClass]="{'alt_nav': config.altNav, 'main_nav': !config.altNav, 'mat-elevation-z8': config.elevationEnabled}">

      <mat-toolbar-row class="p-0">
        <ng-container *ngIf="!config.altNav else altNav">

          <ng-container *ngIf="config.menuBtnEnabled else backBtn">
            <button
              type="button"
              aria-label="Toggle sidenav"
              mat-icon-button
              (click)="toggleDrawer()"
              fxHide fxShow.xs>
              <mat-icon aria-label="Side nav toggle icon">menu</mat-icon>
            </button>
          </ng-container>

          <ng-template #backBtn>
            <button (click)="handleFn(config.backFn)"
             mat-icon-button aria-label="Tilbake">
                <mat-icon class="icon_150">chevron_left</mat-icon>
            </button>
          </ng-template>

          <span class="main-nav-title" [routerLink]="['/hjem']">{{ config.title }}</span>
        </ng-container>

        <ng-template #altNav>
          <span style="margin-right:auto;">

            <button (click)="handleFn(config.backFn)"
             mat-icon-button aria-label="Tilbake">
                <mat-icon class="icon_150">chevron_left</mat-icon>
            </button>

            <ng-container *ngIf="config.subTitle || config.subIcon">
              <mat-icon>{{ config.subIcon }}</mat-icon>
              <small>{{ config.subTitle }}</small>
            </ng-container>

          </span>
        </ng-template>

        <mat-spinner *ngIf="loading$ |  async" diameter="24"></mat-spinner>


        <button mat-icon-button aria-label="Åpne timeliste" 
          *ngFor="let button of config.buttons" 
          [color]="button.color"
          (click)="handleFn(button.callback)">
            <mat-icon>{{ button.icon }}</mat-icon>
        </button>

        <ng-container *ngIf="config.searchFn">
          <button (click)="toggleSearchBar()" mat-icon-button aria-label="Avbryt søk">
            <mat-icon>search</mat-icon>
          </button>

          <app-search-bar [isHidden]="searchBarHidden" (hide)="toggleSearchBar()" (search)="handleFn(config.searchFn, $event, $event)"></app-search-bar>
        </ng-container>

        <button mat-icon-button *ngIf="config.bottomSheetButtons?.length" (click)="openBottomSheet(config.bottomSheetButtons)">
          <mat-icon>more_vert</mat-icon>
        </button>

      </mat-toolbar-row>

      <mat-toolbar-row *ngIf="config.altNav"  class="alt_nav_row">
        <mat-icon *ngIf="config.icon">{{ config.icon }}</mat-icon>  &nbsp;
        <span [innerHTML]="config.title"></span>
      </mat-toolbar-row>

    </mat-toolbar>

    <div class="main_content" [ngClass]="config.altNav ? 'main_content_height_alt' : 'main_content_height_main'">
      <router-outlet></router-outlet>
    </div>

  </mat-sidenav-content>

</mat-sidenav-container>

<app-bottom-nav fxHide fxShow.xs [openTimesheetCount]="openTimesheetCount$ | async"></app-bottom-nav>
